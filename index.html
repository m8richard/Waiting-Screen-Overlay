<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gentle Mates Cards Carousel</title>
  <style>
    /* ----------------- FONT DEFINITIONS ----------------- */
    @font-face {
      font-family: 'HelveticaNeue';
      src: local('HelveticaNeue'), local('Helvetica Neue');
      font-weight: normal;
      font-style: normal;
    }
    @font-face {
      font-family: 'HelveticaNeue';
      src: local('HelveticaNeue-Bold'), local('Helvetica Neue Bold');
      font-weight: 700;
      font-style: normal;
    }
    @font-face {
      font-family: 'HelveticaNeue-Bold';
      src: local('HelveticaNeue-Bold'), local('Helvetica Neue Bold');
      font-weight: bold;
      font-style: normal;
    }
    @font-face {
      font-family: 'HelveticaBoldExtended';
      src: url('https://gmrxbbhhyyrtmsftofdp.supabase.co/storage/v1/object/public/gentle-mates-assets/livedata-overlay/HelveticaNeue-BlackExt.otf') format('opentype');
      font-weight: bold;
      font-style: normal;
    }
    @font-face {
      font-family: 'TuskerGrotesk';
      src: url('https://gmrxbbhhyyrtmsftofdp.supabase.co/storage/v1/object/public/gentle-mates-assets/livedata-overlay/Tusker-Grotesk.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    /* ----------------- GLOBAL STYLES ----------------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #121212;
      overflow: hidden;
      font-family: 'HelveticaNeue', sans-serif;
    }

    .carousel-container {
      width: 1204px;
      height: 633px;
      position: relative;
      border-radius: 40px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      background-color: #FFFFFF;
    }

    .card {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      opacity: 0;
      transition: opacity 1s ease;
      display: flex;
      flex-direction: column;
      border-radius: 40px;
      overflow: hidden;
      z-index: 1;
    }

    .card.active {
      opacity: 1;
      z-index: 3;
    }

    .card.previous {
      z-index: 2;
    }

    /* ----------------- HEADER & FOOTER ----------------- */
    .card-header {
      height: 120px; /* Fixed header height */
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 36px;
    }

    .header-text {
      color: #973a6e;
      font-family: 'HelveticaBoldExtended', sans-serif;
      font-size: 64px;
      text-align: center;
    }

    .date-text {
      color: #2D2D2D;
      font-family: 'HelveticaNeue-Bold', sans-serif;
      font-size: 64px;
    }

    .card-footer {
      height: 120px; /* Fixed footer height */
      background-color: #FCFCFC;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.1);
    }

    .live-logo-link {
      display: flex;
      flex: 1;
      align-items: center;
      justify-content: center;
      gap: 40px;
    }

    .profile-picture {
      height: 80px;
      width: auto;
      border-radius: 8px;
      display: none;
    }

    .platform-logo {
      height: 80px;
      width: auto;
    }

    .channel {
      color: #2D2D2D;
      font-family: 'HelveticaBoldExtended', sans-serif;
      font-size: 80px;
      text-align: center;
    }

    /* ----------------- CARD BODY ----------------- */
    .card-body {
      flex: 1;
      position: relative;
      display: flex;
      padding: 24px 16px;
    }

    .card-body.row {
      flex-direction: row;
      align-items: center;
      justify-content: center;
    }

    .card-body.column {
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .background-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background-image: url('https://gmrxbbhhyyrtmsftofdp.supabase.co/storage/v1/object/public/gentle-mates-assets/livedata-overlay/silver-background.png');
      background-size: cover;
    }

    /* ----------------- MATCHCARD STYLES ----------------- */
    .matchCard .card-header {
      background-color: #F77514;
      justify-content: space-between;
    }

    .matchCard .card-body {
      justify-content: space-around;
      align-items: center;
    }

    .game-logo {
      width: 240px;
      height: 72px;
    }

    .match-name-container {
      height: auto;
      max-width: 720px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .match-name {
      color: #2D2D2D;
      font-family: 'TuskerGrotesk', sans-serif;
      font-size: 96px;
      text-align: center;
      margin-right: 24px;
    }

    .info-container {
      height: 200px;
      width: 320px;
      border-radius: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .matchCard .info-container {
      background-color: #F77514;
    }

    .info-text {
      color: #2D2D2D;
      font-family: 'TuskerGrotesk', sans-serif;
      font-size: 96px;
      text-align: center;
    }

    /* ----------------- MATCHCARD2 STYLES ----------------- */
    .matchCard2 .card-header {
      background-color: #EE0073;
      justify-content: space-between;
    }

    .matchCard2 .info-container {
      background-color: #EE0073;
    }

    .body-container {
      width: 100%;
      display: flex;
      justify-content: space-evenly;
      align-items: center;
    }

    .team-container {
      width: 400px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .team-logo {
      height: 176px;
      width: 176px;
      margin-top: 16px;
      margin-bottom: 24px;
      object-fit: contain;
    }

    .team-name {
      font-size: 40px;
      color: #2D2D2D;
      font-family: 'HelveticaNeue', sans-serif;
      text-align: center;
    }

    .match-name-container-small {
      height: 72px;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0 48px;
      margin-top: 8px;
    }

    .match-name-small {
      color: #2D2D2D;
      font-family: 'HelveticaBoldExtended', sans-serif;
      font-size: 40px;
      text-align: center;
    }

    /* ----------------- YOUTUBE CARD STYLES ----------------- */
    #youtubeCard .card-header {
      background-color: #FF0000;
      justify-content: center;
      align-items: center;
    }

    .youtube-icon-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding-top: 36px;
    }

    .youtube-text {
      color: #B20000;
      font-family: 'HelveticaBoldExtended', sans-serif;
      font-size: 64px;
      text-align: center;
    }

    .youtube-card-container {
      flex: 1.7;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 16px;
    }

    .youtube-thumbnail {
      width: 662px;
      height: 373px;
      border-radius: 16px;
      object-fit: cover;
    }

    .youtube-title {
      width: 700px;
      color: #232323;
      font-family: 'HelveticaBoldExtended', sans-serif;
      font-size: 32px;
      line-height: 34px;
      text-align: center;
      padding-top: 4px;
    }

    .side-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .channel-info {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 24px;
    }

    .m8-logo {
      width: 64px;
      height: 64px;
      border-radius: 16px;
    }

    .channel-name {
      color: #232323;
      font-family: 'HelveticaNeue', sans-serif;
      font-weight: 700;
      font-size: 32px;
      text-align: center;
    }

    .new-video {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px 0;
    }

    .new-video-text {
      color: #232323;
      font-family: 'TuskerGrotesk', sans-serif;
      letter-spacing: 2px;
      font-size: 96px;
      line-height: 104px;
      text-align: center;
    }

    /* ----------------- SHOP CARD STYLES ----------------- */
    #shopCard .card-header {
      background-color: #fc61b7;
      justify-content: center;
    }

    .shop-images-container {
      flex: 1.45;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      height: 100%;
    }

    .shop-item {
      position: absolute;
      top: 50%;
      left: 50%;
    }

    .shop-item-1 {
      height: 560px;
      width: 560px;
      z-index: 2;
      transform: translate(-280px, -280px);
    }

    .shop-item-2 {
      height: 480px;
      width: 480px;
      z-index: 1;
      transform: translate(-400px, -280px);
    }

    .shop-item-3 {
      height: 480px;
      width: 480px;
      z-index: 1;
      transform: translate(-90px, -280px);
    }

    .shop-url-container {
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #fc61b7;
      width: 450px;
      height: 60px;
      border-radius: 12px;
      margin-top: 16px;
    }

    .shop-url {
      color: #973a6e;
      font-family: 'HelveticaNeue', sans-serif;
      font-weight: 900;
      font-size: 32px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      width: 100%;
      display: block;
    }

    .merch-text {
      color: #232323;
      font-family: 'TuskerGrotesk', sans-serif;
      letter-spacing: 2px;
      font-size: 104px;
      line-height: 120px;
      text-align: center;
    }

    /* ----------------- DOWNLOAD THE APP CARD STYLES ----------------- */
    #downloadTheApp {
      background: #EDEDED;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #downloadTheApp .card-body {
      height: 633px;
    }

    .phone-animation-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .side-info-container {
      flex: 1.6;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      align-items: center;
      padding: 0 32px;
      gap: 24px;
    }

    .app-promo-text-1 {
      color: #232323;
      font-family: 'HelveticaBoldExtended', sans-serif;
      font-size: 40px;
      line-height: 48px;
      text-align: center;
    }

    .app-promo-text-2 {
      color: #FF00EC;
      font-family: 'HelveticaBoldExtended', sans-serif;
      font-size: 48px;
      line-height: 56px;
      text-align: center;
    }

    .qr-codes-container {
      display: flex;
      gap: 24px;
      justify-content: center;
    }

    .qr-code {
      height: 280px;
      width: 280px;
      border-radius: 24px;
      border: 8px solid #D6D2D3;
    }

    /* ----------------- PHONE ANIMATION ----------------- */
    .phone {
      position: relative;
      width: 280px;
      height: 570px;
      background-color: black;
      border-radius: 53px;
      overflow: visible;
      transform-style: preserve-3d;
      animation: phoneRotation 24s infinite linear;
      box-shadow: 0px 12px 18px rgba(0, 0, 0, 0.45);
    }

    @keyframes phoneRotation {
      0% { transform: perspective(1200px) rotateY(-35deg) rotateX(8deg); }
      25% { transform: perspective(1200px) rotateY(0deg) rotateX(-8deg); }
      50% { transform: perspective(1200px) rotateY(35deg) rotateX(8deg); }
      75% { transform: perspective(1200px) rotateY(0deg) rotateX(-8deg); }
      100% { transform: perspective(1200px) rotateY(-35deg) rotateX(8deg); }
    }

    .inner-bevel {
      position: absolute;
      top: 2px;
      left: 2px;
      right: 2px;
      bottom: 2px;
      border: 2px solid black;
      border-radius: 51px;
      z-index: 5;
    }

    .screen {
      position: absolute;
      top: 15px;
      left: 15px;
      right: 15px;
      bottom: 15px;
      border-radius: 39px;
      background-color: #000;
      overflow: hidden;
      z-index: 10;
    }

    .screen-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ----------------- LOADING INDICATOR ----------------- */
    .loading {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 24px;
      z-index: 100;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ----------------- SEQUENTIAL ANIMATION STYLES -----------------
         Change the CSS transition durations below (these values control how quickly each element fades in)
         and modify the delays in the JS functions to adjust the pause between each element's animation.
         (They are currently set based on the following:
            - MatchCard/MatchCard2 elements: transition 2.5s → now 0.83s (2.5/3)
            - YouTube thumbnail: 2.5s → now 0.83s; YouTube title/side-info: 1.5s → now 0.5s;
            - ShopCard shop-items: 2s → now 0.67s; ShopCard side-info: 1.5s → now 0.5s;
            - DownloadTheApp phone: 2s → now 0.67s; DownloadTheApp promo texts: 1.5s → now 0.5s.)
    */
    .matchCard .game-logo, 
    .matchCard .date-text,
    .matchCard .info-container,
    .matchCard .match-name-container,
    .matchCard .live-logo-link,
    .matchCard2 .game-logo,
    .matchCard2 .date-text,
    .matchCard2 .info-container,
    .matchCard2 .team-container,
    .matchCard2 .match-name-container-small,
    .matchCard2 .live-logo-link {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.83s ease, transform 0.83s ease;
    }
    #youtubeCard .youtube-thumbnail {
      opacity: 0;
      transform: scale(1.3);
      transition: opacity 0.83s ease, transform 0.83s ease;
    }
    #youtubeCard .youtube-title {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    #youtubeCard .side-info {
      opacity: 0;
      transform: translateX(30px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    #shopCard .shop-item {
      opacity: 0;
      transform: translate(-50%, -50%) scale(1.3);
      transition: opacity 0.67s ease, transform 0.67s ease;
    }
    #shopCard .side-info {
      opacity: 0;
      transform: translateX(30px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    #downloadTheApp .phone {
      opacity: 0;
      transform: perspective(1200px) rotateY(-35deg) rotateX(8deg) scale(0.9);
      transition: opacity 0.67s ease, transform 0.67s ease;
    }
    #downloadTheApp .app-promo-text-1,
    #downloadTheApp .qr-codes-container,
    #downloadTheApp .app-promo-text-2 {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
  </style>
</head>
<body>
  <div class="loading">
    <div class="spinner"></div>
  </div>
  
  <div class="carousel-container">
    <!-- Cards will be dynamically loaded here -->

    <!-- ShopCard -->
    <div id="shopCard" class="card">
      <div class="card-header">
        <div class="header-text">MERCH GENTLE MATES</div>
      </div>
      <div class="card-body row">
        <div class="background-image"></div>
        <div class="shop-images-container">
          <img class="shop-item shop-item-1" src="https://cdn.shopify.com/s/files/1/0727/9575/0735/files/M8_Maillot2025_Frontcopie.png?v=1733336697" alt="Shop Item 1">
          <img class="shop-item shop-item-2" src="https://cdn.shopify.com/s/files/1/0727/9575/0735/files/M8_NOEL_MERCH_ZIP_FRONT.png?v=1733263364" alt="Shop Item 2">
          <img class="shop-item shop-item-3" src="https://cdn.shopify.com/s/files/1/0727/9575/0735/files/M8_NOEL_MERCH_POLAIRE_GREEN_FRONTV3.png?v=1733336980" alt="Shop Item 3">
        </div>
        <div class="side-info">
          <div class="merch-text">MERCH DISPONIBLE</div>
          <div class="shop-url-container">
            <div class="shop-url">GENTLEMATES.COM/SHOP</div>
          </div>
        </div>
      </div>
    </div>

    <!-- DownloadTheApp -->
    <div id="downloadTheApp" class="card">
      <div class="card-body row">
        <div class="background-image"></div>
        <div class="phone-animation-container">
          <div class="phone">
            <div class="inner-bevel"></div>
            <div class="screen">
              <img class="screen-image" src="https://gmrxbbhhyyrtmsftofdp.supabase.co/storage/v1/object/public/gentle-mates-assets/livedata-overlay/gentle-mates-app-screen.png" alt="App Screen">
            </div>
          </div>
        </div>
        <div class="side-info-container">
          <div class="app-promo-text-1">L'EXPÉRIENCE GENTLE MATES À PORTÉE DE MAIN</div>
          <div class="qr-codes-container">
            <img class="qr-code" src="https://gmrxbbhhyyrtmsftofdp.supabase.co/storage/v1/object/public/gentle-mates-assets/livedata-overlay/app_store_qr.png" alt="App Store QR">
            <img class="qr-code" src="https://gmrxbbhhyyrtmsftofdp.supabase.co/storage/v1/object/public/gentle-mates-assets/livedata-overlay/play_store_qr.png" alt="Play Store QR">
          </div>
          <div class="app-promo-text-2">Téléchargez l'App !</div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // Global API credentials and cache
    const TWITCH_CLIENT_ID = '0owgszl3jt5xi963so52m91f92sdgd';
    const TWITCH_CLIENT_SECRET = 'kpdjs0mxt7bub8fky4eq5mn1cduro4';
    const YOUTUBE_API_KEY = 'AIzaSyCxZwYO46mdurmZ6W4bt7n_lTX_4ys5uus';
    const profilePictureCache = {};

    // -------------------------------
    // ANIMATION DURATION PARAMETERS:
    // Adjust these constants to control the animation speeds and delays.
    const FADE_IN_DURATION = 0;         // in ms: New fade-in duration
    const SHORT_TRANSITION_DURATION = 0;  // in ms: For YouTube title/side-info
    const SHOP_ITEM_DURATION = 0;         // in ms: For shop items
    const DOWNLOAD_PHONE_DURATION = 0;    // in ms: For DownloadTheApp phone
    const ZOOM_DURATION = 150;              // in ms: Duration of the zoom effect
    const ZOOM_SCALE = 1.3;                // Zoom scale factor (1.3 times bigger)
    const SEQUENTIAL_DELAY = 1300;          // in ms: Delay between each element's animation
    // -------------------------------

    // Function to adjust font size in the shop URL container
    function adjustShopUrlFontSize() {
      const container = document.querySelector('.shop-url-container');
      const textElement = document.querySelector('.shop-url');
      if (!container || !textElement) return;
      textElement.style.fontSize = '32px';
      const containerWidth = container.clientWidth;
      const textWidth = textElement.scrollWidth;
      if (textWidth > containerWidth - 20) {
        const ratio = (containerWidth - 20) / textWidth;
        const newFontSize = Math.floor(32 * ratio);
        textElement.style.fontSize = `${newFontSize}px`;
      }
    }
    window.addEventListener('resize', adjustShopUrlFontSize);

    // Extract channel name from URL
    function extractChannelName(url) {
      if (!url) return "";
      const regex = /^(?:https?:\/\/)?(?:www\.)?(?:twitch\.tv\/|youtube\.com\/@)([^\/?]+)/i;
      const match = url.match(regex);
      return match ? match[1] : "";
    }

    // Get platform logo URL. If no URL is provided, force Twitch logo.
    function getPlatformLogo(url) {
      const twitchLogoURL = "https://gmrxbbhhyyrtmsftofdp.supabase.co/storage/v1/object/public/gentle-mates-assets//twitch_colored_logo.png";
      if (!url) return twitchLogoURL;
      const youtubeLogoURL = "https://gmrxbbhhyyrtmsftofdp.supabase.co/storage/v1/object/public/gentle-mates-assets//youtube_colored_logo.png";
      if (url.toLowerCase().includes("youtube")) {
        return youtubeLogoURL;
      } else if (url.toLowerCase().includes("twitch")) {
        return twitchLogoURL;
      }
      return twitchLogoURL;
    }

    // Apply a zoom effect to an element after its animation
    function applyZoomEffect(el, zoomDuration = ZOOM_DURATION) {
      const finalTransform = el.style.transform;
      let zoomTransform = finalTransform;
      if(finalTransform.includes("scale(")){
        zoomTransform = finalTransform.replace(/scale\(\s*1(?:\.0+)?\s*\)/, `scale(${ZOOM_SCALE})`);
      } else {
        zoomTransform = finalTransform + ` scale(${ZOOM_SCALE})`;
      }
      el.style.transition = `transform ${zoomDuration}ms ease`;
      el.style.transform = zoomTransform;
      setTimeout(() => {
        el.style.transform = finalTransform;
      }, zoomDuration);
    }

    // Create HTML for MatchCard (type 1)
    function createMatchCardHTML(match, game) {
      const { date, time } = formatDateTime(match.live_datetime);
      const twitchLink = match.twitch_live_link;
      const channelName = twitchLink ? extractChannelName(twitchLink).toUpperCase() : "GENTLE MATES";
      const platformLogo = getPlatformLogo(twitchLink);
      const gameLogoURL = game?.dark_logo_url || "";
      const gameColor = game?.secondary_color || "#F77514";
      return `
        <div id="matchCard-${match.id}" class="card matchCard">
          <div class="card-header" style="background-color: ${gameColor};">
            <img class="game-logo" src="${gameLogoURL}" alt="Game Logo">
            <div class="date-text">${date}</div>
          </div>
          <div class="card-body row">
            <div class="background-image"></div>
            <div class="match-name-container">
              <div class="match-name">${match.name}</div>
            </div>
            <div class="info-container" style="background-color: ${gameColor};">
              <div class="info-text">${time}</div>
            </div>
          </div>
          <div class="card-footer">
            <div class="live-logo-link" data-channel-url="${twitchLink || ''}">
              <img class="platform-logo" src="${platformLogo}" alt="Platform Logo">
              <div class="channel">${channelName}</div>
              <img class="profile-picture" src="" alt="Profile Picture">
            </div>
          </div>
        </div>
      `;
    }

    // Create HTML for MatchCard2 (type 2)
    function createMatchCard2HTML(match, game, teamA, teamB) {
      const { date, time } = formatDateTime(match.live_datetime);
      const twitchLink = match.twitch_live_link;
      const channelName = twitchLink ? extractChannelName(twitchLink).toUpperCase() : "GENTLE MATES";
      const platformLogo = getPlatformLogo(twitchLink);
      const gameLogoURL = game?.dark_logo_url || "";
      const gameColor = game?.secondary_color || "#EE0073";
      const teamAName = teamA?.name || "Team A";
      const teamBName = teamB?.name || "Team B";
      const teamALogoURL = teamA?.dark_logo_url || "";
      const teamBLogoURL = teamB?.dark_logo_url || "";
      return `
        <div id="matchCard2-${match.id}" class="card matchCard2">
          <div class="card-header" style="background-color: ${gameColor};">
            <img class="game-logo" src="${gameLogoURL}" alt="Game Logo">
            <div class="date-text">${date}</div>
          </div>
          <div class="card-body column">
            <div class="background-image"></div>
            <div class="body-container">
              <div class="team-container">
                <img class="team-logo" src="${teamALogoURL}" alt="${teamAName} Logo">
                <div class="team-name">${teamAName}</div>
              </div>
              <div class="info-container" style="background-color: ${gameColor};">
                <div class="info-text">${time}</div>
              </div>
              <div class="team-container">
                <img class="team-logo" src="${teamBLogoURL}" alt="${teamBName} Logo">
                <div class="team-name">${teamBName}</div>
              </div>
            </div>
            <div class="match-name-container-small">
              <div class="match-name-small">${match.name}</div>
            </div>
          </div>
          <div class="card-footer">
            <div class="live-logo-link" data-channel-url="${twitchLink || ''}">
              <img class="platform-logo" src="${platformLogo}" alt="Platform Logo">
              <div class="channel">${channelName}</div>
              <img class="profile-picture" src="" alt="Profile Picture">
            </div>
          </div>
        </div>
      `;
    }

    // Create HTML for YoutubeCard
    function createYoutubeCardHTML(videoData) {
      const youtubeId = videoData.youtube_id;
      const thumbnailUrl = `https://i.ytimg.com/vi/${youtubeId}/maxresdefault.jpg`;
      const title = videoData.title_fr;
      const postDate = new Date(videoData.post_date);
      const threeDaysAgo = new Date();
      threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
      const newVideoText = postDate > threeDaysAgo ? "NOUVELLE VIDÉO" : "DERNIÈRE VIDÉO";
      return `
        <div id="youtubeCard" class="card">
          <div class="card-header">
            <div class="youtube-icon-container">
              <svg width="80" height="80" viewBox="0 0 24 24" style="align-self: center;">
                <path
                  fill="#B20000"
                  d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01 0 0 1 1.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.01 2.01 0 0 1-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309 0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.01 2.01 0 0 1-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82l-.008-.104A31 31 0 0 1 0 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.01 2.01 0 0 1 1.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A100 100 0 0 1 7.858 2zM6.4 5.209v4.818l4.157-2.408z"
                />
                <path fill="#FF0000" d="M6.4 5.209v4.818l4.157-2.408z" />
              </svg>
            </div>
            <div class="youtube-text">YOUTUBE</div>
          </div>
          <div class="card-body row">
            <div class="background-image"></div>
            <div class="youtube-card-container">
              <img class="youtube-thumbnail" src="${thumbnailUrl}" alt="YouTube Thumbnail">
              <div class="youtube-title">${title}</div>
            </div>
            <div class="side-info">
              <div class="channel-info">
                <img class="m8-logo" src="https://gmrxbbhhyyrtmsftofdp.supabase.co/storage/v1/object/public/gentle-mates-assets/livedata-overlay/m8_logo.png" alt="M8 Logo">
                <div class="channel-name">GENTLE MATES</div>
              </div>
              <div class="new-video">
                <div class="new-video-text">${newVideoText}</div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Format date and time function
    function formatDateTime(dateTimeStr) {
      const dateObj = new Date(dateTimeStr);
      const now = new Date();
      const isToday = dateObj.getDate() === now.getDate() &&
                      dateObj.getMonth() === now.getMonth() &&
                      dateObj.getFullYear() === now.getFullYear();
      const tomorrow = new Date(now);
      tomorrow.setDate(tomorrow.getDate() + 1);
      const isTomorrow = dateObj.getDate() === tomorrow.getDate() &&
                         dateObj.getMonth() === tomorrow.getMonth() &&
                         dateObj.getFullYear() === tomorrow.getFullYear();
      let formattedDate;
      if (isToday) {
        formattedDate = "Aujourd'hui";
      } else if (isTomorrow) {
        formattedDate = "Demain";
      } else {
        const dateOptions = { weekday: "long", day: "numeric", month: "long" };
        formattedDate = dateObj.toLocaleDateString("fr-FR", dateOptions);
        formattedDate = formattedDate.split(" ").map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(" ");
      }
      const hours = dateObj.getHours();
      const minutes = dateObj.getMinutes();
      const formattedTime = `${hours.toString().padStart(2, "0")}H${minutes.toString().padStart(2, "0")}`;
      return { date: formattedDate, time: formattedTime };
    }

    // ---------------------------
    // PROFILE PICTURE FUNCTIONS
    // The following functions fetch and update the profile pictures.
    // If the API calls fail (e.g. due to CORS issues or incorrect channel URLs), the images won't be updated.
    // ---------------------------

    async function getTwitchProfilePicture(channelUrl) {
      if (profilePictureCache[channelUrl]) return profilePictureCache[channelUrl];
      const channelName = extractChannelName(channelUrl).toLowerCase();
      try {
        // Added Content-Type header for POST request
        const tokenResponse = await fetch(`https://id.twitch.tv/oauth2/token?client_id=${TWITCH_CLIENT_ID}&client_secret=${TWITCH_CLIENT_SECRET}&grant_type=client_credentials`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
        });
        const tokenData = await tokenResponse.json();
        const token = tokenData.access_token;
        if (!token) return null;
        const userResponse = await fetch(`https://api.twitch.tv/helix/users?login=${channelName}`, {
          headers: {
            'Client-ID': TWITCH_CLIENT_ID,
            'Authorization': 'Bearer ' + token
          }
        });
        const userData = await userResponse.json();
        if (userData.data && userData.data.length > 0) {
          const profilePicUrl = userData.data[0].profile_image_url;
          profilePictureCache[channelUrl] = profilePicUrl;
          return profilePicUrl;
        }
      } catch (error) {
        console.error('Twitch API error:', error);
      }
      return null;
    }

    async function getYoutubeProfilePicture(channelUrl) {
      if (profilePictureCache[channelUrl]) return profilePictureCache[channelUrl];
      const channelName = extractChannelName(channelUrl);
      try {
        const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&q=${channelName}&key=${YOUTUBE_API_KEY}`);
        const data = await response.json();
        if (data.items && data.items.length > 0) {
          const profilePicUrl = data.items[0].snippet.thumbnails.default.url;
          profilePictureCache[channelUrl] = profilePicUrl;
          return profilePicUrl;
        }
      } catch (error) {
        console.error('YouTube API error:', error);
      }
      return null;
    }

    async function updateProfilePictures() {
      const liveLogoLinks = document.querySelectorAll('.live-logo-link');
      liveLogoLinks.forEach(link => {
        const channelUrl = link.getAttribute('data-channel-url');
        if (!channelUrl) return;
        if (channelUrl.toLowerCase().includes('twitch')) {
          getTwitchProfilePicture(channelUrl).then(profilePicUrl => {
            if (profilePicUrl) {
              const profileImg = link.querySelector('.profile-picture');
              profileImg.src = profilePicUrl;
              profileImg.style.display = 'block';
            }
          });
        } else if (channelUrl.toLowerCase().includes('youtube')) {
          getYoutubeProfilePicture(channelUrl).then(profilePicUrl => {
            if (profilePicUrl) {
              const profileImg = link.querySelector('.profile-picture');
              profileImg.src = profilePicUrl;
              profileImg.style.display = 'block';
            }
          });
        }
      });
    }

    // ---------------------------
    // ANIMATE ELEMENT FUNCTIONS:
    // To adjust the delays between each element's animation inside a card,
    // change the delay values in the setTimeout calls in the functions below.
    // Also, to change the zoom effect duration, modify the ZOOM_DURATION parameter above.
    // ---------------------------

    function animateMatchCard(card) {
      const elements = [];
      elements.push(card.querySelector('.game-logo'));
      elements.push(card.querySelector('.date-text'));
      elements.push(card.querySelector('.info-container'));
      if (card.classList.contains('matchCard')) {
        elements.push(card.querySelector('.match-name-container'));
      } else if (card.classList.contains('matchCard2')) {
        const teamContainers = card.querySelectorAll('.team-container');
        teamContainers.forEach(container => {
          if (container) elements.push(container);
        });
        elements.push(card.querySelector('.match-name-container-small'));
      }
      elements.push(card.querySelector('.live-logo-link'));
      setTimeout(() => {
        let delay = 0;
        elements.forEach((el, index) => {
          if (el) {
            setTimeout(() => {
              el.style.opacity = '1';
              el.style.transform = 'translateY(0)';
              setTimeout(() => { applyZoomEffect(el); }, 100);
            }, delay);
            delay += SEQUENTIAL_DELAY;
          }
        });
      }, 50);
    }

    function animateYoutubeCard(card) {
      const thumbnail = card.querySelector('.youtube-thumbnail');
      const title = card.querySelector('.youtube-title');
      const sideInfo = card.querySelector('.side-info');
      setTimeout(() => {
        if (thumbnail) {
          setTimeout(() => {
            thumbnail.style.opacity = '1';
            thumbnail.style.transform = 'scale(1)';
            setTimeout(() => { thumbnail; }, 100);
          }, 0);
        }
        if (title) {
          setTimeout(() => {
            title.style.opacity = '1';
            title.style.transform = 'translateY(0)';
            setTimeout(() => { title; }, 100);
          }, 1000);
        }
        if (sideInfo) {
          setTimeout(() => {
            sideInfo.style.opacity = '1';
            sideInfo.style.transform = 'translateX(0)';
            setTimeout(() => { applyZoomEffect(sideInfo); }, 100);
          }, 2000);
        }
      }, 50);
    }

    function animateShopCard(card) {
      const shopItem1 = card.querySelector('.shop-item-1');
      const shopItem2 = card.querySelector('.shop-item-2');
      const shopItem3 = card.querySelector('.shop-item-3');
      const sideInfo = card.querySelector('.side-info');
      setTimeout(() => {
        if (shopItem2) {
          setTimeout(() => {
            shopItem2.style.opacity = '1';
            shopItem2.style.transform = 'translate(-400px, -280px) scale(1)';
            setTimeout(() => { shopItem2; }, 100);
          }, 0);
        }
        if (shopItem3) {
          setTimeout(() => {
            shopItem3.style.opacity = '1';
            shopItem3.style.transform = 'translate(-90px, -280px) scale(1)';
            setTimeout(() => { shopItem3; }, 100);
          }, 750);
        }
        if (shopItem1) {
          setTimeout(() => {
            shopItem1.style.opacity = '1';
            shopItem1.style.transform = 'translate(-280px, -280px) scale(1)';
            setTimeout(() => { shopItem1; }, 100);
          }, 1500);
        }
        if (sideInfo) {
          setTimeout(() => {
            sideInfo.style.opacity = '1';
            sideInfo.style.transform = 'translateX(0)';
            setTimeout(() => { applyZoomEffect(sideInfo); }, 100);
          }, 2500);
        }
      }, 50);
    }

    function animateDownloadAppCard(card) {
      const phone = card.querySelector('.phone');
      const promoText1 = card.querySelector('.app-promo-text-1');
      const qrCodesContainer = card.querySelector('.qr-codes-container');
      const promoText2 = card.querySelector('.app-promo-text-2');
      setTimeout(() => {
        if (phone) {
          setTimeout(() => {
            phone.style.opacity = '1';
            phone.style.transform = 'perspective(1200px) rotateY(-35deg) rotateX(8deg) scale(1)';
            setTimeout(() => { phone; }, 100);
          }, 0);
        }
        if (promoText1) {
          setTimeout(() => {
            promoText1.style.opacity = '1';
            promoText1.style.transform = 'translateY(0)';
            setTimeout(() => { promoText1; }, 100);
          }, 1000);
        }
        if (qrCodesContainer) {
          setTimeout(() => {
            qrCodesContainer.style.opacity = '1';
            qrCodesContainer.style.transform = 'translateY(0)';
            setTimeout(() => { qrCodesContainer; }, 100);
          }, 2000);
        }
        if (promoText2) {
          setTimeout(() => {
            promoText2.style.opacity = '1';
            promoText2.style.transform = 'translateY(0)';
            setTimeout(() => { applyZoomEffect(promoText2); }, 100);
          }, 3000);
        }
      }, 50);
    }

    function resetCardElements(card) {
      if (!card) return;
      if (card.classList.contains('matchCard') || card.classList.contains('matchCard2')) {
        const matchElements = [
          card.querySelector('.game-logo'),
          card.querySelector('.date-text'),
          card.querySelector('.info-container'),
          card.querySelector('.match-name-container'),
          card.querySelector('.live-logo-link')
        ];
        if (card.classList.contains('matchCard2')) {
          const teamContainers = card.querySelectorAll('.team-container');
          teamContainers.forEach(container => {
            if (container) matchElements.push(container);
          });
          matchElements.push(card.querySelector('.match-name-container-small'));
        }
        matchElements.forEach(el => {
          if (el) {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
          }
        });
      } else if (card.id === 'youtubeCard') {
        const thumbnail = card.querySelector('.youtube-thumbnail');
        const title = card.querySelector('.youtube-title');
        const sideInfo = card.querySelector('.side-info');
        if (thumbnail) {
          thumbnail.style.opacity = '0';
          thumbnail.style.transform = 'scale(1.3)';
        }
        if (title) {
          title.style.opacity = '0';
          title.style.transform = 'translateY(20px)';
        }
        if (sideInfo) {
          sideInfo.style.opacity = '0';
          sideInfo.style.transform = 'translateX(30px)';
        }
      } else if (card.id === 'shopCard') {
        const shopItem1 = card.querySelector('.shop-item-1');
        const shopItem2 = card.querySelector('.shop-item-2');
        const shopItem3 = card.querySelector('.shop-item-3');
        const sideInfo = card.querySelector('.side-info');
        if (shopItem1) {
          shopItem1.style.opacity = '0';
          shopItem1.style.transform = 'translate(-280px, -280px) scale(1.3)';
        }
        if (shopItem2) {
          shopItem2.style.opacity = '0';
          shopItem2.style.transform = 'translate(-400px, -280px) scale(1.3)';
        }
        if (shopItem3) {
          shopItem3.style.opacity = '0';
          shopItem3.style.transform = 'translate(-90px, -280px) scale(1.3)';
        }
        if (sideInfo) {
          sideInfo.style.opacity = '0';
          sideInfo.style.transform = 'translateX(30px)';
        }
      } else if (card.id === 'downloadTheApp') {
        const phone = card.querySelector('.phone');
        const promoText1 = card.querySelector('.app-promo-text-1');
        const qrCodesContainer = card.querySelector('.qr-codes-container');
        const promoText2 = card.querySelector('.app-promo-text-2');
        if (phone) {
          phone.style.opacity = '0';
          phone.style.transform = 'perspective(1200px) rotateY(-35deg) rotateX(8deg) scale(0.9)';
        }
        [promoText1, qrCodesContainer, promoText2].forEach(el => {
          if (el) {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
          }
        });
      }
    }

    function setupCarousel() {
      const cards = document.querySelectorAll('.card');
      let currentCardIndex = 0;
      let previousCardIndex = null;
      const durations = Array(cards.length).fill(18000);
      const downloadAppIndex = Array.from(cards).findIndex(card => card.id === 'downloadTheApp');
      if (downloadAppIndex !== -1) {
        durations[downloadAppIndex] = 23000;
      }
      function animateCardElements(card) {
        if (!card) return;
        if (card.classList.contains('matchCard') || card.classList.contains('matchCard2')) {
          animateMatchCard(card);
        } else if (card.id === 'youtubeCard') {
          animateYoutubeCard(card);
        } else if (card.id === 'shopCard') {
          animateShopCard(card);
        } else if (card.id === 'downloadTheApp') {
          animateDownloadAppCard(card);
        }
      }
      function showCard(nextIndex) {
        if (previousCardIndex !== null) {
          cards[previousCardIndex].classList.remove('previous');
        }
        resetCardElements(cards[nextIndex]);
        cards[currentCardIndex].classList.add('previous');
        cards[currentCardIndex].classList.remove('active');
        cards[nextIndex].classList.add('active');
        setTimeout(() => {
          animateCardElements(cards[nextIndex]);
        }, 500);
        setTimeout(() => {
          previousCardIndex = currentCardIndex;
          currentCardIndex = nextIndex;
          cards.forEach((card, index) => {
            if (index !== currentCardIndex && index !== previousCardIndex) {
              card.classList.remove('active', 'previous');
              resetCardElements(card);
            }
          });
          if (cards[nextIndex].id === 'shopCard') {
            adjustShopUrlFontSize();
          }
        }, 1000);
      }
      function nextCard() {
        const nextIndex = (currentCardIndex + 1) % cards.length;
        showCard(nextIndex);
        setTimeout(nextCard, durations[nextIndex]);
      }
      cards.forEach(card => {
        resetCardElements(card);
      });
      cards[currentCardIndex].classList.add('active');
      setTimeout(() => {
        animateCardElements(cards[currentCardIndex]);
      }, 500);
      setTimeout(nextCard, durations[0]);
      adjustShopUrlFontSize();
    }

    async function loadCards() {
      const container = document.querySelector('.carousel-container');
      const shopCard = document.getElementById('shopCard');
      const downloadTheAppCard = document.getElementById('downloadTheApp');
      const loadingIndicator = document.querySelector('.loading');
      
      try {
        const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm');
        const { DateTime } = await import('https://cdn.jsdelivr.net/npm/luxon/+esm');
        const SUPABASE_URL = 'https://gmrxbbhhyyrtmsftofdp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdtcnhiYmhoeXlydG1zZnRvZmRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDc0MDAxNTEsImV4cCI6MjAyMjk3NjE1MX0.JYVVlCII2iL97cevWvQi0Hlz0Gt_nZjonb9ApnNDscc';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        async function fetchUpcomingMatches() {
          const now = new Date().toISOString();
          const { data, error } = await supabase
              .from('matches')
              .select('*')
              .gt('live_datetime', now)
              .order('live_datetime', { ascending: true })
              .limit(3);
          if (error) {
            console.error('Error fetching matches:', error);
            return [];
          }
          return data;
        }
        async function fetchGameById(gameId) {
          const { data, error } = await supabase
              .from('games')
              .select('*')
              .eq('id', gameId)
              .single();
          if (error) {
            console.error(`Error fetching game with id ${gameId}:`, error);
            return null;
          }
          return data;
        }
        async function fetchTeamById(teamId) {
          if (!teamId) return null;
          const { data, error } = await supabase
              .from('teams')
              .select('*')
              .eq('id', teamId)
              .single();
          if (error) {
            console.error(`Error fetching team with id ${teamId}:`, error);
            return null;
          }
          return data;
        }
        async function fetchLatestYoutubeVideo() {
          const { data, error } = await supabase
              .from('youtube_videos')
              .select('*')
              .order('post_date', { ascending: false })
              .limit(1)
              .single();
          if (error) {
            console.error('Error fetching latest youtube video:', error);
            return null;
          }
          return data;
        }
        const matches = await fetchUpcomingMatches();
        const latestVideo = await fetchLatestYoutubeVideo();
        const matchCards = [];
        for (const match of matches) {
          const game = await fetchGameById(match.game_id);
          if (match.team_b_id === null) {
            const matchCardHTML = createMatchCardHTML(match, game);
            matchCards.push(matchCardHTML);
          } else {
            const teamA = await fetchTeamById(match.team_a_id);
            const teamB = await fetchTeamById(match.team_b_id);
            const matchCard2HTML = createMatchCard2HTML(match, game, teamA, teamB);
            matchCards.push(matchCard2HTML);
          }
        }
        let youtubeCardHTML = '';
        if (latestVideo) {
          youtubeCardHTML = createYoutubeCardHTML(latestVideo);
        }
        shopCard.remove();
        downloadTheAppCard.remove();
        container.innerHTML = matchCards.join('') + youtubeCardHTML;
        container.appendChild(shopCard);
        container.appendChild(downloadTheAppCard);
        setupCarousel();
        adjustShopUrlFontSize();
        updateProfilePictures();
      } catch (error) {
        console.error('Error loading cards:', error);
      } finally {
        loadingIndicator.style.display = 'none';
      }
    }

    document.addEventListener('DOMContentLoaded', async function() {
      try {
        await loadCards();
      } catch (error) {
        console.error('Initialization error:', error);
        document.querySelector('.loading').textContent = 'Error loading carousel. Please refresh the page.';
      }
    });
  </script>
</body>
</html>
